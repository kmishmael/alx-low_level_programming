More twiddling with malloc and free
